<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MP4 ‚Üí WebM/AVI/GIF –û–Ω–ª–∞–π–Ω –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä</title>
<style>
body { margin:0; font-family:"Segoe UI", sans-serif; background:#0f172a; color:#f1f5f9; display:flex; flex-direction:column; align-items:center; min-height:100vh; }
.card { background:#1e293b; padding:32px; border-radius:14px; max-width:600px; width:100%; text-align:center; margin-top:40px; }
input[type="file"] { display:none; }
label { display:inline-block; padding:12px 20px; background:#334155; border-radius:10px; cursor:pointer; margin:10px 0; color:white; }
label.selected { border:2px solid #2563eb; }
button { padding:12px 24px; border:none; border-radius:10px; background:#2563eb; color:white; cursor:pointer; margin-top:10px;}
button:hover:not(:disabled) { background:#1e40af; }
button:disabled { background:#9ca3af; cursor:not-allowed; }
select { margin-top:10px; padding:8px 12px; border-radius:10px; border:1px solid #d1d5db; }
#status { margin-top:12px; font-size:0.9rem; min-height:24px; }
ul { text-align:left; padding-left:20px; }
ul li { margin-bottom:4px; }
</style>
</head>
<body>

<div class="card">
  <h1>üé¨ MP4 ‚Üí WebM / AVI / GIF</h1>
  <p>–ö–æ–Ω–≤–µ—Ä—Ç—É–π—Ç–µ –≤—ñ–¥–µ–æ –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ. –ü—Ä–∞—Ü—é—î –Ω–∞ GitHub Pages.</p>

  <input id="videoInput" type="file" accept="video/*" multiple>
  <label for="videoInput" id="fileLabel">üìÇ –û–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–µ–æ</label>
  <ul id="fileList"></ul>

  <div style="margin-top:16px;">
    <label for="format">–§–æ—Ä–º–∞—Ç:</label><br>
    <select id="format">
      <option value="webm">WebM</option>
      <option value="avi">AVI</option>
      <option value="gif">GIF</option>
    </select>
  </div>

  <div style="margin-top:16px;">
    <label for="quality">–Ø–∫—ñ—Å—Ç—å:</label><br>
    <select id="quality">
      <option value="high">–í–∏—Å–æ–∫–∞</option>
      <option value="medium">–°–µ—Ä–µ–¥–Ω—è</option>
      <option value="low">–ù–∏–∑—å–∫–∞</option>
    </select>
  </div>

  <div style="margin-top:16px;">
    <label for="resolution">–†–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å:</label><br>
    <select id="resolution">
      <option value="360">360p</option>
      <option value="480">480p</option>
      <option value="720">720p</option>
      <option value="1080">1080p</option>
    </select>
  </div>

  <button id="convertBtn" disabled>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è FFmpeg...</button>
  <div id="status">–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è...</div>
</div>

<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
<script>
const { createFFmpeg, fetchFile } = FFmpeg;

// corePath –º–æ–∂–Ω–∞ –∑–∞–ª–∏—à–∏—Ç–∏ –Ω–∞ CDN, –±–æ GitHub Pages –ø—ñ–¥—Ç—Ä–∏–º—É—î HTTP/HTTPS
const ffmpeg = createFFmpeg({
  log: true,
  corePath: 'https://unpkg.com/@ffmpeg/core-st@0.11.1/dist/ffmpeg-core.js'
});

const input = document.getElementById('videoInput');
const btn = document.getElementById('convertBtn');
const status = document.getElementById('status');
const fileLabel = document.getElementById('fileLabel');
const fileListDisplay = document.getElementById('fileList');
const formatSelect = document.getElementById('format');
const qualitySelect = document.getElementById('quality');
const resolutionSelect = document.getElementById('resolution');

let isLoaded = false;

// –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è FFmpeg
async function loadFFmpeg() {
  if(isLoaded) return;
  status.innerText = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —è–¥—Ä–∞ FFmpeg...';
  await ffmpeg.load();
  isLoaded = true;
  btn.disabled = false;
  btn.innerText = '–ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏';
  status.innerText = '–ì–æ—Ç–æ–≤–æ ‚úÖ';
}
window.addEventListener('load', loadFFmpeg);

// –û–±—Ä–æ–±–∫–∞ –≤–∏–±–æ—Ä—É —Ñ–∞–π–ª—ñ–≤
input.addEventListener('change', () => {
  const files = input.files;
  fileListDisplay.innerHTML = '';
  if(files.length > 0) {
    fileLabel.classList.add('selected');
    for(let i=0; i<files.length; i++) {
      const li = document.createElement('li');
      li.textContent = files[i].name;
      fileListDisplay.appendChild(li);
    }
  } else {
    fileLabel.classList.remove('selected');
  }
});

// –ü—Ä–æ–≥—Ä–µ—Å –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó
ffmpeg.setProgress(({ ratio }) => {
  status.innerText = `–ü—Ä–æ–≥—Ä–µ—Å: ${(ratio*100).toFixed(0)}%`;
});

// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è
btn.addEventListener('click', async () => {
  const files = input.files;
  if(!files.length) return alert('–û–±–µ—Ä—ñ—Ç—å –≤—ñ–¥–µ–æ—Ñ–∞–π–ª–∏');
  btn.disabled = true;

  const format = formatSelect.value;
  const quality = qualitySelect.value;
  const resolution = resolutionSelect.value;

  let bitrate;
  switch(quality) {
    case 'high': bitrate='2000k'; break;
    case 'medium': bitrate='1000k'; break;
    case 'low': bitrate='500k'; break;
  }

  try {
    for(let i=0; i<files.length; i++){
      const file = files[i];
      status.innerText = `–ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è ${i+1}/${files.length}: ${file.name}`;

      ffmpeg.FS('writeFile', 'input.mp4', await fetchFile(file));

      const outputName = `output.${format}`;
      let scaleArg = (format==='gif') ? 'scale=320:-1' : `scale=-2:${resolution}`;

      if(format==='gif'){
        await ffmpeg.run('-i','input.mp4','-t','10','-vf',`fps=10,${scaleArg}`, outputName);
      } else {
        await ffmpeg.run('-i','input.mp4','-b:v',bitrate,'-vf',scaleArg, outputName);
      }

      const data = ffmpeg.FS('readFile', outputName);
      const url = URL.createObjectURL(new Blob([data.buffer], { type:`video/${format}` }));
      const a = document.createElement('a');
      a.href = url;
      a.download = file.name.replace(/\.[^/.]+$/,"") + `.${format}`;
      a.click();
    }
    status.innerText = '–£—Å—ñ —Ñ–∞–π–ª–∏ –≥–æ—Ç–æ–≤—ñ ‚úÖ';
  } catch(err){
    console.error(err);
    status.innerText = '–ü–æ–º–∏–ª–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó ‚ùå';
  } finally{
    btn.disabled = false;
  }
});
</script>
</body>
</html>
